# Architecture du Module Project

> Documentation de l'architecture DDD/CQRS du module de gestion des projets portfolio

**Version:** 1.0
**Derni√®re mise √† jour:** 2025-10-10
**Auteurs:** √âquipe Soundscape

---

## Table des mati√®res

1. [Vue d'ensemble](#vue-densemble)
2. [Architecture en couches](#architecture-en-couches)
3. [R√®gles m√©tier critiques](#r√®gles-m√©tier-critiques)
4. [Value Objects](#value-objects)
5. [Commandes et Queries](#commandes-et-queries)
6. [Flow de donn√©es](#flow-de-donn√©es)
7. [Gestion des erreurs](#gestion-des-erreurs)
8. [Points d'attention](#points-dattention)
9. [Roadmap](#roadmap)

---

## Vue d'ensemble

Le module **Project** permet la gestion compl√®te des projets portfolio d'un ing√©nieur du son. Il suit une architecture **Domain-Driven Design (DDD)** avec s√©paration **CQRS (Command Query Responsibility Segregation)**.

### Principes architecturaux

- ‚úÖ **DDD** - Le domaine m√©tier est au c≈ìur, isol√© de l'infrastructure
- ‚úÖ **CQRS** - S√©paration stricte entre op√©rations d'√©criture (Commands) et de lecture (Queries)
- ‚úÖ **Always Valid** - Les Value Objects garantissent leurs invariants √† la cr√©ation
- ‚úÖ **Immutabilit√©** - Les Value Objects sont readonly, le slug d'un projet est immutable
- ‚úÖ **TDD** - D√©veloppement pilot√© par les tests (RED-GREEN-REFACTOR)

### Technologies

- **PHP 8.3** avec typage strict
- **Laravel 12** pour l'infrastructure
- **Pest** pour les tests
- **Mockery** pour les mocks

---

## Architecture en couches

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PRESENTATION LAYER                        ‚îÇ
‚îÇ              (Controllers, Livewire, Views)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   APPLICATION LAYER                          ‚îÇ
‚îÇ         (Handlers, DTOs, Commands, Queries)                  ‚îÇ
‚îÇ  ‚Ä¢ CreateProjectHandler                                      ‚îÇ
‚îÇ  ‚Ä¢ UpdateProjectHandler                                      ‚îÇ
‚îÇ  ‚Ä¢ DeleteProjectHandler                                      ‚îÇ
‚îÇ  ‚Ä¢ GetProjectsHandler                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     DOMAIN LAYER                             ‚îÇ
‚îÇ       (Entities, Value Objects, Repositories, Rules)         ‚îÇ
‚îÇ  ‚Ä¢ Project (Entity)                                          ‚îÇ
‚îÇ  ‚Ä¢ ProjectTitle, ProjectSlug, ClientName, etc. (VOs)        ‚îÇ
‚îÇ  ‚Ä¢ ProjectRepository (Interface)                             ‚îÇ
‚îÇ  ‚Ä¢ Exceptions domaine                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 INFRASTRUCTURE LAYER                         ‚îÇ
‚îÇ          (Repositories, Eloquent Models, DB)                 ‚îÇ
‚îÇ  ‚Ä¢ ProjectDatabaseRepository                                 ‚îÇ
‚îÇ  ‚Ä¢ Project Model (Eloquent)                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 1. Domain Layer (`app/Domain/Admin/`)

**Responsabilit√© :** R√®gles m√©tier pures, ind√©pendantes de toute infrastructure.

**Structure :**
```
Domain/Admin/
‚îú‚îÄ‚îÄ Entities/
‚îÇ   ‚îú‚îÄ‚îÄ Project.php                 # Entit√© agr√©gat
‚îÇ   ‚îú‚îÄ‚îÄ Enums/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProjectStatus.php       # Draft, Published, Archived
‚îÇ   ‚îî‚îÄ‚îÄ ValueObjects/
‚îÇ       ‚îú‚îÄ‚îÄ ProjectTitle.php
‚îÇ       ‚îú‚îÄ‚îÄ ProjectSlug.php
‚îÇ       ‚îú‚îÄ‚îÄ ProjectDescription.php
‚îÇ       ‚îú‚îÄ‚îÄ ProjectShortDescription.php
‚îÇ       ‚îú‚îÄ‚îÄ ClientName.php
‚îÇ       ‚îî‚îÄ‚îÄ ProjectDate.php
‚îú‚îÄ‚îÄ Repositories/
‚îÇ   ‚îî‚îÄ‚îÄ ProjectRepository.php       # Interface repository
‚îî‚îÄ‚îÄ Exceptions/
    ‚îú‚îÄ‚îÄ ProjectNotFoundException.php
    ‚îú‚îÄ‚îÄ DuplicateProjectSlugException.php
    ‚îú‚îÄ‚îÄ InvalidProjectTitleException.php
    ‚îú‚îÄ‚îÄ InvalidClientNameException.php
    ‚îú‚îÄ‚îÄ InvalidProjectDescriptionException.php
    ‚îî‚îÄ‚îÄ InvalidProjectShortDescriptionException.php
```

**R√®gles :**
- ‚ùå **Aucune d√©pendance** vers Laravel ou infrastructure
- ‚úÖ Contient la logique m√©tier pure
- ‚úÖ Les Value Objects sont `readonly` et valid√©s
- ‚úÖ Les exceptions sont sp√©cifiques au domaine

### 2. Application Layer (`app/Application/Admin/`)

**Responsabilit√© :** Orchestration des cas d'usage, coordination entre domaine et infrastructure.

**Structure :**
```
Application/Admin/
‚îú‚îÄ‚îÄ Commands/
‚îÇ   ‚îú‚îÄ‚îÄ CreateProject/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CreateProjectHandler.php
‚îÇ   ‚îú‚îÄ‚îÄ UpdateProject/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UpdateProjectHandler.php
‚îÇ   ‚îî‚îÄ‚îÄ DeleteProject/
‚îÇ       ‚îî‚îÄ‚îÄ DeleteProjectHandler.php
‚îú‚îÄ‚îÄ Queries/
‚îÇ   ‚îî‚îÄ‚îÄ GetProjects/
‚îÇ       ‚îî‚îÄ‚îÄ GetProjectsHandler.php
‚îî‚îÄ‚îÄ DTOs/
    ‚îú‚îÄ‚îÄ CreateProjectData.php
    ‚îú‚îÄ‚îÄ UpdateProjectData.php
    ‚îî‚îÄ‚îÄ ProjectData.php
```

**R√®gles :**
- ‚úÖ Handlers sont `readonly` avec injection de d√©pendances
- ‚úÖ Pas de logique m√©tier (d√©l√©gation au domaine)
- ‚úÖ Conversion des DTOs en Value Objects
- ‚úÖ Gestion des cha√Ænes vides ‚Üí `null` avant cr√©ation des VOs

### 3. Infrastructure Layer (`app/Infra/Repositories/Admin/`)

**Responsabilit√© :** Impl√©mentation concr√®te de la persistance.

**Structure :**
```
Infra/Repositories/Admin/
‚îî‚îÄ‚îÄ ProjectDatabaseRepository.php   # Impl√©mente ProjectRepository
```

**R√®gles :**
- ‚úÖ Impl√©mente les interfaces du domaine
- ‚úÖ Utilise Eloquent pour la persistance
- ‚úÖ Convertit entre mod√®les Eloquent et entit√©s domaine
- ‚úÖ Lance des exceptions domaine si n√©cessaire

### 4. Presentation Layer (`app/Http/Controllers/Admin/`)

**Responsabilit√© :** Interface utilisateur, HTTP, formulaires.

**Structure :**
```
Http/Controllers/Admin/
‚îî‚îÄ‚îÄ ProjectController.php
```

**R√®gles :**
- ‚úÖ Injection des handlers dans le constructeur
- ‚úÖ Validation Laravel (Form Requests)
- ‚úÖ D√©l√©gation aux handlers
- ‚ùå Aucune logique m√©tier

---

## R√®gles m√©tier critiques

### üîê R√®gle 1 : Slug Immutable

**Le slug d'un projet ne change JAMAIS apr√®s cr√©ation.**

```php
// ‚úÖ CORRECT
$project = Project::new(title: 'My Project');  // slug: "my-project"
$project->update(title: ProjectTitle::fromString('New Title'));
echo $project->getSlug();  // Toujours "my-project"

// ‚ùå INTERDIT - Impossible de modifier le slug
// Pas de m√©thode setSlug() ou updateSlug()
```

**Raison :** Stabilit√© des URLs, SEO, r√©f√©rences externes.

---

### üîê R√®gle 2 : Gestion du Status

**Les changements de status se font via des commandes d√©di√©es.**

```php
// ‚úÖ CORRECT - M√©thodes d√©di√©es sur l'entit√©
$project->publish();   // Draft ‚Üí Published
$project->archive();   // * ‚Üí Archived
$project->draft();     // * ‚Üí Draft

// ‚ùå INTERDIT - Pas via update()
// $project->update(..., status: $newStatus)  // N'existe pas
```

**Commandes d√©di√©es (√† impl√©menter) :**
- `PublishProjectHandler` - Publie un projet (Draft ‚Üí Published)
- `ArchiveProjectHandler` - Archive un projet
- `DraftProjectHandler` - Repasse en brouillon

---

### üîê R√®gle 3 : Validation "Always Valid"

**Un Value Object ne peut JAMAIS exister dans un √©tat invalide.**

```php
// ‚úÖ CORRECT
$title = ProjectTitle::fromString('Valid Title');  // OK

// ‚ùå LANCE InvalidProjectTitleException
ProjectTitle::fromString('');         // Vide
ProjectTitle::fromString('   ');      // Espaces uniquement
ProjectTitle::fromString(str_repeat('a', 256));  // > 255 chars
```

**Implication :** La validation se fait **√† la cr√©ation** du VO, pas ailleurs.

---

### üîê R√®gle 4 : Gestion des Champs Optionnels

**Les champs optionnels vides sont convertis en `null`.**

```php
// ‚úÖ CORRECT - Conversion dans les handlers
$description = $data->description !== null && trim($data->description) !== ''
    ? $data->description
    : null;

// Si $description est null ‚Üí pas de VO cr√©√©
// Si $description a une valeur ‚Üí VO cr√©√© avec validation
$project->update(
    description: $description !== null
        ? ProjectDescription::fromString($description)
        : null
);
```

**Logique :**
- Pas de donn√©es ‚Üí `null` (pas de VO)
- Donn√©es pr√©sentes ‚Üí VO cr√©√© + validation stricte
- Formulaires envoient `""` ‚Üí converti en `null` par handlers

---

### üîê R√®gle 5 : Factory Methods

**Deux m√©thodes pour cr√©er un Project :**

```php
// 1. Cr√©ation d'un nouveau projet (g√©n√®re slug, status Draft)
Project::new(
    title: 'My Project',
    description: 'Description',
    // ...
);

// 2. Reconstitution depuis DB (slug + status fournis)
Project::reconstitute(
    title: $title,
    slug: $slug,
    status: $status,
    // ...
);
```

**‚ùå INTERDIT :** Utiliser `new()` pour reconstitution ou `reconstitute()` pour cr√©ation.

---

## Value Objects

### Vue d'ensemble

| Value Object | Limite | Vide autoris√© | Sp√©cificit√©s |
|--------------|--------|---------------|--------------|
| `ProjectTitle` | 255 chars | ‚ùå Non | Trim auto |
| `ClientName` | 255 chars | ‚ùå Non | Title Case, normalisation espaces |
| `ProjectDescription` | ‚àû Illimit√©e | ‚ùå Non | Markdown, multiligne |
| `ProjectShortDescription` | 500 chars | ‚ùå Non | R√©sum√© court |
| `ProjectSlug` | - | ‚ùå Non | Format strict (lowercase, hyphens) |
| `ProjectDate` | - | - | Carbon wrapper |
| `ProjectStatus` | - | - | Enum (Draft, Published, Archived) |

### Validation d√©taill√©e

#### ProjectTitle

```php
ProjectTitle::fromString('My Project');  // ‚úÖ OK

// ‚ùå Exceptions
ProjectTitle::fromString('');                    // InvalidProjectTitleException
ProjectTitle::fromString('   ');                 // InvalidProjectTitleException
ProjectTitle::fromString(str_repeat('a', 256));  // InvalidProjectTitleException (> 255)
```

#### ClientName

```php
ClientName::fromString('acme corporation');  // ‚úÖ "Acme Corporation" (Title Case)

// Normalisation avanc√©e
ClientName::fromString('soci√©t√© d\'√©tude');  // ‚úÖ "Soci√©t√© D'√âtude"
ClientName::fromString('ACME   INC');        // ‚úÖ "Acme Inc" (espaces normalis√©s)

// ‚ùå Exceptions
ClientName::fromString('');                  // InvalidClientNameException
ClientName::fromString(str_repeat('a', 256)); // InvalidClientNameException (> 255)
```

#### ProjectDescription

```php
$markdown = "# Title\n\n**Bold** text";
ProjectDescription::fromString($markdown);  // ‚úÖ Pr√©serve markdown

// ‚ùå Exception
ProjectDescription::fromString('');         // InvalidProjectDescriptionException
ProjectDescription::fromString('   ');      // InvalidProjectDescriptionException
```

**‚ö†Ô∏è Pas de limite de longueur** - Descriptions peuvent √™tre tr√®s longues.

#### ProjectShortDescription

```php
ProjectShortDescription::fromString('Court r√©sum√©');  // ‚úÖ OK
ProjectShortDescription::fromString(str_repeat('a', 500));  // ‚úÖ Limite exacte OK

// ‚ùå Exceptions
ProjectShortDescription::fromString('');                    // Exception
ProjectShortDescription::fromString(str_repeat('a', 501));  // Exception (> 500)
```

#### ProjectSlug

```php
// ‚úÖ Valides
ProjectSlug::fromString('my-project');       // OK
ProjectSlug::fromString('project-2024-v2');  // OK avec chiffres

// G√©n√©ration depuis titre
ProjectSlug::fromTitle(ProjectTitle::fromString('Mon Projet √ât√© 2024 !'));
// ‚Üí "mon-projet-ete-2024"

// ‚ùå Invalides
ProjectSlug::fromString('My-Project');    // Majuscules interdites
ProjectSlug::fromString('my project');    // Espaces interdits
ProjectSlug::fromString('my_project');    // Underscores interdits
ProjectSlug::fromString('-my-project');   // D√©but par tiret interdit
ProjectSlug::fromString('my-project-');   // Fin par tiret interdit
```

---

## Commandes et Queries

### Commandes (Write Side)

#### 1. CreateProject

**Handler :** `CreateProjectHandler`

**Responsabilit√©s :**
1. Cr√©e l'entit√© `Project` via `Project::new()`
2. V√©rifie l'unicit√© du slug via `findBySlug()`
3. Lance `DuplicateProjectSlugException` si slug existe
4. Persiste via `repository->store()`
5. Retourne le `ProjectSlug`

**Flux :**
```
Controller ‚Üí CreateProjectData (DTO)
    ‚Üí CreateProjectHandler
        ‚Üí Project::new() (g√©n√®re slug)
        ‚Üí repository->findBySlug() (v√©rification)
        ‚Üí repository->store()
    ‚Üí ProjectSlug (retour)
```

**Tests :** `CreateProjectHandlerTest.php` (5 tests)

---

#### 2. UpdateProject

**Handler :** `UpdateProjectHandler`

**Responsabilit√©s :**
1. R√©cup√®re le projet via `getBySlug()` (lance exception si absent)
2. Convertit les cha√Ænes vides en `null`
3. Appelle `$project->update()` (slug et status pr√©serv√©s)
4. Persiste via `repository->store()`

**Flux :**
```
Controller ‚Üí UpdateProjectData (DTO)
    ‚Üí UpdateProjectHandler
        ‚Üí repository->getBySlug() (r√©cup√©ration)
        ‚Üí $project->update() (mise √† jour)
        ‚Üí repository->store()
```

**‚ö†Ô∏è Comportement :**
- **Slug** reste inchang√©
- **Status** reste inchang√©
- Champs optionnels peuvent √™tre r√©initialis√©s √† `null`

**Tests :** `UpdateProjectHandlerTest.php` (7 tests)

---

#### 3. DeleteProject

**Handler :** `DeleteProjectHandler`

**Responsabilit√©s :**
1. Supprime via `repository->delete(slug)`
2. Lance `ProjectNotFoundException` si projet inexistant

**Flux :**
```
Controller ‚Üí DeleteProjectHandler
    ‚Üí repository->delete(slug)
        ‚Üí Lance exception si 0 suppression
```

**‚ö†Ô∏è Actuellement : Hard delete** (suppression d√©finitive)

**Tests :** `DeleteProjectHandlerTest.php` (3 tests)

---

### Queries (Read Side)

#### GetProjects

**Handler :** `GetProjectsHandler`

**Responsabilit√©s :**
1. R√©cup√®re tous les projets via `repository->getAll()`
2. Transforme en `ProjectData` (DTOs)
3. Retourne une `Collection`

**Flux :**
```
Controller ‚Üí GetProjectsHandler
    ‚Üí repository->getAll()
        ‚Üí Collection<Project>
    ‚Üí map to ProjectData
        ‚Üí Collection<ProjectData>
```

**Tests :** `GetProjectsHandlerTest.php` (3 tests)

---

## Flow de donn√©es

### Exemple : Cr√©ation d'un projet

```
1. User soumet formulaire
   ‚Üì
2. ProjectController::store(CreateProjectRequest $request)
   ‚Üì
3. CreateProjectData::fromArray($request->validated())
   ‚Üì
4. CreateProjectHandler::handle(CreateProjectData $data)
   ‚Üì
5. Project::new(title: $data->title, ...)
   ‚îÇ  ‚Ä¢ Cr√©e ProjectTitle::fromString($data->title)  ‚Üí Validation
   ‚îÇ  ‚Ä¢ G√©n√®re ProjectSlug::fromTitle($title)
   ‚îÇ  ‚Ä¢ Status = ProjectStatus::Draft
   ‚îÇ  ‚Ä¢ Cr√©e autres Value Objects avec validation
   ‚Üì
6. repository->findBySlug($slug)  ‚Üí V√©rification unicit√©
   ‚îÇ  ‚Ä¢ Si existe ‚Üí DuplicateProjectSlugException
   ‚Üì
7. repository->store($project)
   ‚îÇ  ‚Ä¢ Convertit Project ‚Üí Eloquent Model
   ‚îÇ  ‚Ä¢ ProjectDatabase::updateOrCreate(...)
   ‚Üì
8. Retour ProjectSlug
   ‚Üì
9. Redirect vers admin.project.index
```

### Exemple : Mise √† jour d'un projet

```
1. User modifie formulaire (change title, vide description)
   ‚Üì
2. ProjectController::update(Project $project, UpdateProjectRequest $request)
   ‚Üì
3. UpdateProjectData avec slug du projet
   ‚Üì
4. UpdateProjectHandler::handle(UpdateProjectData $data)
   ‚Üì
5. repository->getBySlug($slug)
   ‚îÇ  ‚Ä¢ Si absent ‚Üí ProjectNotFoundException
   ‚Üì
6. Conversion cha√Ænes vides ‚Üí null
   ‚îÇ  $description = trim($data->description) !== '' ? $data->description : null
   ‚Üì
7. $project->update(
   ‚îÇ     title: ProjectTitle::fromString($data->title),
   ‚îÇ     description: $description !== null
   ‚îÇ         ? ProjectDescription::fromString($description)
   ‚îÇ         : null
   ‚îÇ  )
   ‚îÇ  ‚Ä¢ Slug et status pr√©serv√©s
   ‚Üì
8. repository->store($project)
   ‚Üì
9. Redirect
```

---

## Gestion des erreurs

### Exceptions domaine

| Exception | Quand ? | HTTP Code sugg√©r√© |
|-----------|---------|-------------------|
| `ProjectNotFoundException` | Projet introuvable par slug | 404 |
| `DuplicateProjectSlugException` | Slug d√©j√† existant √† la cr√©ation | 409 Conflict |
| `InvalidProjectTitleException` | Titre vide ou > 255 chars | 422 Unprocessable |
| `InvalidClientNameException` | Nom client vide ou > 255 chars | 422 Unprocessable |
| `InvalidProjectDescriptionException` | Description vide | 422 Unprocessable |
| `InvalidProjectShortDescriptionException` | Description courte vide ou > 500 chars | 422 Unprocessable |

### Strat√©gie de gestion

**Au niveau Application (Handlers) :**
```php
// Les handlers laissent remonter les exceptions domaine
public function handle(CreateProjectData $data): ProjectSlug
{
    $project = Project::new(...);  // Peut lancer Invalid*Exception

    $existing = $this->repository->findBySlug($project->getSlug());
    if ($existing !== null) {
        throw DuplicateProjectSlugException::forSlug($project->getSlug());
    }

    $this->repository->store($project);
    return $project->getSlug();
}
```

**Au niveau Presentation (Controllers) :**
```php
// Option 1 : Try/catch dans controller
try {
    $slug = $this->createProjectHandler->handle($data);
    return redirect()->route('admin.project.show', $slug);
} catch (DuplicateProjectSlugException $e) {
    return back()->withErrors(['title' => 'Un projet avec ce titre existe d√©j√†']);
} catch (InvalidProjectTitleException $e) {
    return back()->withErrors(['title' => $e->getMessage()]);
}

// Option 2 : Global exception handler (recommand√©)
// app/Exceptions/Handler.php
```

---

## Points d'attention

### ‚ùå Pi√®ges √† √©viter

1. **Ne jamais utiliser `Project::new()` pour reconstitution**
   ```php
   // ‚ùå INTERDIT
   $project = Project::new(title: $dbRow['title'], ...);

   // ‚úÖ CORRECT
   $project = Project::reconstitute(
       title: ProjectTitle::fromString($dbRow['title']),
       slug: ProjectSlug::fromString($dbRow['slug']),
       status: ProjectStatus::from($dbRow['status']),
       // ...
   );
   ```

2. **Ne jamais cr√©er un VO avec une valeur vide**
   ```php
   // ‚ùå INTERDIT - Lance exception
   $description = ProjectDescription::fromString('');

   // ‚úÖ CORRECT - Utiliser null
   $description = null;
   ```

3. **Ne jamais bypasser les handlers**
   ```php
   // ‚ùå INTERDIT - Acc√®s direct au repository
   $repository->store($project);

   // ‚úÖ CORRECT - Toujours via handler
   $handler->handle($data);
   ```

4. **Ne jamais valider dans les handlers**
   ```php
   // ‚ùå INTERDIT - Validation dans handler
   if (strlen($data->title) > 255) {
       throw new \Exception('...');
   }

   // ‚úÖ CORRECT - Validation dans VO
   ProjectTitle::fromString($data->title);  // Lance exception si invalide
   ```

5. **Toujours convertir cha√Ænes vides ‚Üí null**
   ```php
   // ‚úÖ CORRECT - Dans les handlers
   $clientName = $data->clientName !== null && trim($data->clientName) !== ''
       ? $data->clientName
       : null;
   ```

### ‚úÖ Bonnes pratiques

1. **Typage strict partout**
   ```php
   declare(strict_types=1);
   ```

2. **Handlers readonly avec injection**
   ```php
   final readonly class CreateProjectHandler
   {
       public function __construct(
           private ProjectRepository $repository,
       ) {}
   }
   ```

3. **Value Objects readonly**
   ```php
   final readonly class ProjectTitle
   {
       private function __construct(
           private string $title,
       ) {}
   }
   ```

4. **Tests unitaires pour tous les handlers**
   - Chemins heureux (happy path)
   - Cas d'erreur (exceptions)
   - Cas limites (null, vide, etc.)

---

## Roadmap

### üî¥ Priorit√© Haute - Fonctionnalit√©s manquantes

#### 1. Commandes de gestion du status

**√Ä impl√©menter :**
- [ ] `PublishProjectHandler` - Publie un projet (Draft ‚Üí Published)
- [ ] `ArchiveProjectHandler` - Archive un projet (‚Üí Archived)
- [ ] `DraftProjectHandler` - Repasse en brouillon (‚Üí Draft)

**Structure :**
```
Application/Admin/Commands/
‚îú‚îÄ‚îÄ PublishProject/
‚îÇ   ‚îî‚îÄ‚îÄ PublishProjectHandler.php
‚îú‚îÄ‚îÄ ArchiveProject/
‚îÇ   ‚îî‚îÄ‚îÄ ArchiveProjectHandler.php
‚îî‚îÄ‚îÄ DraftProject/
    ‚îî‚îÄ‚îÄ DraftProjectHandler.php
```

**R√®gles m√©tier :**
- V√©rifier les transitions valides (ex: on ne peut pas publier un projet archiv√© ?)
- Events domaine (ProjectPublished, ProjectArchived, etc.)
- V√©rifications suppl√©mentaires (projet complet avant publication ?)

---

#### 2. Soft Deletes

**Actuellement :** Hard delete (suppression d√©finitive)

**√Ä consid√©rer :**
- Soft delete avec `deleted_at`
- Restauration de projets supprim√©s
- Purge d√©finitive apr√®s X jours

---

#### 3. Events Domaine

**√Ä impl√©menter :**
```
Domain/Admin/Events/
‚îú‚îÄ‚îÄ ProjectCreated.php
‚îú‚îÄ‚îÄ ProjectUpdated.php
‚îú‚îÄ‚îÄ ProjectDeleted.php
‚îú‚îÄ‚îÄ ProjectPublished.php
‚îî‚îÄ‚îÄ ProjectArchived.php
```

**Cas d'usage :**
- Notifications
- Audit log
- Synchronisation avec services externes
- Cache invalidation

---

### üü° Priorit√© Moyenne

#### 4. Query enrichies

**√Ä consid√©rer :**
- `GetProjectBySlugHandler` - R√©cup√®re un projet par slug
- `GetPublishedProjectsHandler` - Liste projets publi√©s (pour portfolio public)
- `SearchProjectsHandler` - Recherche par titre/description
- Filtres par status, date, client

---

#### 5. Validation m√©tier avanc√©e

**√Ä consid√©rer :**
- Validation coh√©rence globale (ex: projet avec m√©dia obligatoire avant publication)
- R√®gles de nommage des slugs (r√©servation de slugs ?)
- Limite nombre de projets par utilisateur

---

### üü¢ Priorit√© Basse

#### 6. Optimisations

- Cache des projets publi√©s
- Eager loading automatique des relations
- Pagination des listes

---

## R√©f√©rences

### Documentation externe
- [Domain-Driven Design par Eric Evans](https://www.domainlanguage.com/ddd/)
- [CQRS pattern](https://martinfowler.com/bliki/CQRS.html)
- [Laravel Documentation](https://laravel.com/docs/12.x)

### Fichiers cl√©s du projet
- `app/Domain/Admin/Entities/Project.php` - Entit√© agr√©gat
- `app/Domain/Admin/Repositories/ProjectRepository.php` - Interface repository
- `app/Infra/Repositories/Admin/ProjectDatabaseRepository.php` - Impl√©mentation
- `app/Application/Admin/Commands/` - Handlers des commandes
- `tests/Unit/Application/Admin/Commands/` - Tests des handlers

---

**Questions ou suggestions ?**
Contactez l'√©quipe de d√©veloppement ou ouvrez une issue sur le repository.